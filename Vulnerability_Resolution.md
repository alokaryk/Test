<p>Perfect ‚úÖ &mdash; below is your <strong>Full Vulnerability Resolution &amp; Hardening Guide</strong> in <strong>Markdown format</strong>, written specifically for your production <strong>email server</strong>:<br /> <code>mail.gailgaspng.com</code> (CentOS 7, cPanel, Exim, Dovecot, Apache, MySQL).</p>
<p>All steps are safe for <strong>production</strong>, and designed to <strong>maintain mail functionality</strong> while closing vulnerabilities reported in your file.</p>
<hr />
<h1>üõ†Ô∏è Vulnerability Resolution &amp; Hardening Guide</h1>
<p><strong>Server:</strong> mail.gailgaspng.com<br /> <strong>OS:</strong> CentOS Linux 7 (Core)<br /> <strong>Role:</strong> Email + cPanel hosting<br /> <strong>Interface:</strong> ens192 (multiple public IPs)</p>
<hr />
<h2>üß© Table of Contents</h2>
<ol>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#1-system-update--pre-checks">System Update &amp; Pre-checks</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#2-exim-smtp-hardening">Exim (SMTP) Hardening</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#3-dovecot-imappop3-hardening">Dovecot (IMAP/POP3) Hardening</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#4-mysql-exposure-fix">MySQL Exposure Fix</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#5-openssh-security-hardening">OpenSSH Security Hardening</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#6-http-proxy-port-8015-exposure-fix">HTTP Proxy (Port 8015) Exposure Fix</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#7-tls--ssl-certificate-best-practices">TLS / SSL Certificate Best Practices</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#8-firewall-configuration-allow-email-block-others">Firewall Configuration (Allow Email, Block Others)</a></p>
</li>
<li>
<p><a href="https://chatgpt.com/c/68e75c10-c330-8321-bbd9-80cf2c635fbd#9-verification-steps">Verification Steps</a></p>
</li>
</ol>
<hr />
<h2>1. üß∞ System Update &amp; Pre-checks</h2>
<p>Run the following to ensure all base packages and libraries are up-to-date.</p>
<pre><code class="language-bash"># Enable required repos and update everything safely
sudo yum clean all
sudo yum update -y

# Check for kernel or security advisories
sudo yum list-security
sudo yum update --security -y
</code></pre>
<p>Reboot only <strong>if kernel updates were applied</strong>:</p>
<pre><code class="language-bash">sudo reboot
</code></pre>
<p>Check versions:</p>
<pre><code class="language-bash">cat /etc/redhat-release
uname -r
</code></pre>
<hr />
<h2>2. ‚úâÔ∏è Exim (SMTP) Hardening</h2>
<p><strong>Ports:</strong> 25, 465, 587<br /> <strong>Service:</strong> <code>/usr/sbin/exim</code> (cPanel-managed)</p>
<h3>Fix 1: Enable mandatory TLS for email submission</h3>
<p>Edit <code>/etc/exim.conf</code> (or via WHM &rarr; <em>Service Configuration &rarr; Exim Configuration Manager &rarr; Security</em>):</p>
<pre><code class="language-bash">tls_advertise_hosts = *
tls_on_connect_ports = 465
tls_require_ciphers = HIGH:!aNULL:!MD5
tls_certificate = /etc/ssl/certs/exim.crt
tls_privatekey = /etc/ssl/private/exim.key
</code></pre>
<p>Then restart Exim:</p>
<pre><code class="language-bash">/scripts/restartsrv_exim
</code></pre>
<h3>Fix 2: Disable open relay</h3>
<p>Ensure <code>/etc/exim.conf</code> includes:</p>
<pre><code class="language-bash">hostlist relay_from_hosts = 127.0.0.1 : ::1
</code></pre>
<p>Check:</p>
<pre><code class="language-bash">exim -bP | grep relay_from_hosts
</code></pre>
<h3>Fix 3: Enable SPF, DKIM, and DMARC</h3>
<p>In cPanel/WHM:</p>
<pre><code>WHM &rarr; Email Deliverability &rarr; Enable SPF &amp; DKIM
</code></pre>
<p>For DMARC, create DNS record:</p>
<pre><code>_dmarc.gailgaspng.com  TXT  "v=DMARC1; p=quarantine; rua=mailto:postmaster@gailgaspng.com"
</code></pre>
<hr />
<h2>3. üì¨ Dovecot (IMAP/POP3) Hardening</h2>
<p><strong>Ports:</strong> 143, 110 (plain) and 993, 995 (secure)</p>
<h3>Fix 1: Enforce SSL/TLS only</h3>
<p>Edit <code>/etc/dovecot/dovecot.conf</code> or <code>/etc/dovecot/conf.d/10-ssl.conf</code>:</p>
<pre><code class="language-bash">ssl = required
ssl_min_protocol = TLSv1.2
ssl_cipher_list = HIGH:!aNULL:!MD5
disable_plaintext_auth = yes
</code></pre>
<h3>Fix 2: Disable non-secure ports (optional if users use IMAPS/POP3S)</h3>
<pre><code class="language-bash"># Comment out these lines in /etc/dovecot/conf.d/10-master.conf
service imap-login {
  inet_listener imap {
    # port = 143
  }
}
service pop3-login {
  inet_listener pop3 {
    # port = 110
  }
}
</code></pre>
<p>Restart:</p>
<pre><code class="language-bash">/scripts/restartsrv_dovecot
</code></pre>
<hr />
<h2>4. üóÑÔ∏è MySQL Exposure Fix</h2>
<p><strong>Port:</strong> 3306<br /> <strong>Risk:</strong> Database accessible publicly.</p>
<h3>Fix 1: Bind MySQL only to localhost</h3>
<p>Edit <code>/etc/my.cnf</code>:</p>
<pre><code class="language-bash">[mysqld]
bind-address = 127.0.0.1
</code></pre>
<p>Restart MySQL:</p>
<pre><code class="language-bash">/scripts/restartsrv_mysql
</code></pre>
<h3>Fix 2: Ensure secure credentials</h3>
<pre><code class="language-bash">mysql_secure_installation
</code></pre>
<h3>Fix 3: Verify external access is closed</h3>
<pre><code class="language-bash">nmap -p 3306 127.0.0.1
nmap -p 3306 &lt;public_IP&gt;
</code></pre>
<p>Only local IP should respond.</p>
<hr />
<h2>5. üîí OpenSSH Security Hardening</h2>
<p><strong>Port:</strong> 22<br /> <strong>Detected:</strong> OpenSSH_7.4 (outdated, weak ciphers)</p>
<h3>Fix 1: Update OpenSSH</h3>
<pre><code class="language-bash">sudo yum update openssh-server openssh-clients -y
</code></pre>
<h3>Fix 2: Restrict login methods and disable root SSH</h3>
<p>Edit <code>/etc/ssh/sshd_config</code>:</p>
<pre><code class="language-bash">Protocol 2
PermitRootLogin no
PasswordAuthentication no
PermitEmptyPasswords no
MaxAuthTries 3
ClientAliveInterval 300
ClientAliveCountMax 2
LoginGraceTime 30
UseDNS no
AllowUsers admin_user
Ciphers aes256-ctr,aes192-ctr,aes128-ctr
MACs hmac-sha2-512,hmac-sha2-256
</code></pre>
<p>Then restart SSH:</p>
<pre><code class="language-bash">systemctl restart sshd
</code></pre>
<hr />
<h2>6. üåê HTTP Proxy (Port 8015) Exposure Fix</h2>
<p><strong>Risk:</strong> Open proxy could allow abuse.</p>
<h3>Fix 1: Identify process</h3>
<pre><code class="language-bash">sudo netstat -tulpn | grep 8015
</code></pre>
<p>If it&rsquo;s <strong>Squid</strong> or <strong>FortiGuard</strong>:</p>
<pre><code class="language-bash">sudo systemctl stop squid
sudo systemctl disable squid
</code></pre>
<h3>Fix 2: Block port 8015 from public access</h3>
<pre><code class="language-bash">firewall-cmd --permanent --remove-port=8015/tcp
firewall-cmd --reload
</code></pre>
<hr />
<h2>7. üîê TLS / SSL Certificate Best Practices</h2>
<h3>Fix 1: Ensure valid certificates</h3>
<pre><code class="language-bash">/usr/local/cpanel/bin/checkallsslcerts
</code></pre>
<p>Auto-renews Let's Encrypt or Sectigo certificates.</p>
<h3>Fix 2: Enforce strong TLS protocols</h3>
<p>In <code>/etc/httpd/conf.d/ssl.conf</code>:</p>
<pre><code class="language-bash">SSLProtocol all -SSLv2 -SSLv3 -TLSv1 -TLSv1.1
SSLCipherSuite HIGH:!aNULL:!MD5:!3DES
SSLHonorCipherOrder on
</code></pre>
<p>Restart Apache:</p>
<pre><code class="language-bash">/scripts/restartsrv_httpd
</code></pre>
<hr />
<h2>8. üß± Firewall Configuration (Allow Email, Block Others)</h2>
<h3>Fix 1: Allow only essential ports</h3>
<pre><code class="language-bash">firewall-cmd --permanent --add-service={smtp,ssmtp,imaps,pop3s,http,https,dns}
firewall-cmd --permanent --add-port=2083/tcp
firewall-cmd --permanent --add-port=2096/tcp
firewall-cmd --permanent --add-port=465/tcp
firewall-cmd --permanent --add-port=587/tcp
firewall-cmd --permanent --add-port=25/tcp
firewall-cmd --permanent --add-port=993/tcp
firewall-cmd --permanent --add-port=995/tcp
firewall-cmd --permanent --add-port=53/udp
firewall-cmd --permanent --add-port=53/tcp
</code></pre>
<h3>Fix 2: Block unused ports</h3>
<pre><code class="language-bash"># Close dangerous/unneeded ports
firewall-cmd --permanent --remove-port=8015/tcp
firewall-cmd --permanent --remove-port=3306/tcp
firewall-cmd --permanent --remove-port=110/tcp
firewall-cmd --permanent --remove-port=143/tcp
firewall-cmd --reload
</code></pre>
<hr />
<h2>9. ‚úÖ Verification Steps</h2>
<table>
<thead>
<tr>
<th>Check</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Firewall rules active</strong></td>
<td><code>firewall-cmd --list-all</code></td>
</tr>
<tr>
<td><strong>SMTP TLS working</strong></td>
<td><code>openssl s_client -starttls smtp -crlf -connect mail.gailgaspng.com:587</code></td>
</tr>
<tr>
<td><strong>IMAPS connectivity</strong></td>
<td><code>openssl s_client -connect mail.gailgaspng.com:993</code></td>
</tr>
<tr>
<td><strong>No MySQL exposure</strong></td>
<td><code>nmap -p 3306 49.50.65.177</code> (should be filtered)</td>
</tr>
<tr>
<td><strong>SSH security</strong></td>
<td><code>ssh -Q cipher</code> (should show only AES CTR modes)</td>
</tr>
<tr>
<td><strong>All services running</strong></td>
<td><code>systemctl status exim dovecot httpd mysqld sshd</code></td>
</tr>
</tbody>
</table>
<hr />
<h1>üßæ Summary</h1>
<table>
<thead>
<tr>
<th>Service</th>
<th>Action Taken</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Exim (SMTP)</strong></td>
<td>TLS enforced, open relay disabled</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>Dovecot (IMAP/POP3)</strong></td>
<td>SSL required, plain ports optional</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>MySQL</strong></td>
<td>Local-only bind</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>SSH</strong></td>
<td>Updated, weak ciphers removed</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>HTTP Proxy (8015)</strong></td>
<td>Stopped + blocked via firewall</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>TLS/SSL</strong></td>
<td>Strong ciphers + auto-renew</td>
<td>‚úÖ Secured</td>
</tr>
<tr>
<td><strong>Firewall</strong></td>
<td>Mail ports open, others closed</td>
<td>‚úÖ Hardened</td>
</tr>
</tbody>
</table>
<hr />
<p>Would you like me to create a <strong>server-specific checklist (in Markdown)</strong> so you can track which of these fixes are completed (‚úÖ / ‚è≥ / ‚ùå)?<br /> It&rsquo;s useful for internal compliance and future audits.</p>
<!-- Comments are visible in the HTML source only -->
